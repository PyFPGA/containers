FROM ubuntu:latest AS build

WORKDIR /root

RUN apt update -qq \
 && DEBIAN_FRONTEND=noninteractive apt install -y --no-install-recommends \
    # Common
    build-essential \
    ca-certificates \
    git \
    python3 \
    zlib1g-dev \
    # vhd2vl
    flex \
    bison \
    iverilog \
    # Surelog
    cmake \
    default-jre \
    python3-orderedmultidict \
 && apt autoclean && apt clean && apt -y autoremove \
 && rm -rf /var/lib/apt/lists/*

#
# vhd2vl
#

RUN git clone --depth 1 https://github.com/ldoolitt/vhd2vl \
 && cd vhd2vl && make -j$(nproc) \
 && cp src/vhd2vl /usr/local/bin

#
# Slang
#

RUN git clone --depth 1 https://github.com/MikePopoloski/slang.git \
 && cd slang && cmake -B build && cmake --build build -j8 \
 && cmake --install build --strip

#
# Surelog
#

RUN git clone --depth 1 https://github.com/alainmarcel/Surelog.git \
 && cd Surelog && git submodule update --init --recursive \
 && make -j$(nproc) && make install

###############################################################################

## slang
#/usr/local/lib/libfmt.a
#/usr/local/include/fmt
#/usr/local/lib/cmake/fmt
#/usr/local/include/ieee1800
#/usr/local/lib/libfmt.a
#/usr/local/lib/libmimalloc.a
#/usr/local/include/mimalloc-2.1
#/usr/local/include/slang
#/usr/local/include/slang
#/usr/local/bin/slang
#/usr/local/bin/slang-netlist
#/usr/local/bin/slang-tidy
#/usr/local/bin/slang-reflect
#/usr/local/bin/slang-hier
#/usr/local/lib/libsvlang.a
#/usr/local/bin/slang
#/usr/local/lib/cmake/slang
#/usr/local/share/pkgconfig/sv-lang.pc

## Surelog
#/usr/local/lib/libcapnp.a
#/usr/local/lib/libkj.a
#/usr/local/lib/libuhdm.a
#/usr/local/bin/uhdm-cmp
#/usr/local/bin/uhdm-dump
#/usr/local/bin/uhdm-hier
#/usr/local/bin/uhdm-lint
#/usr/local/include/uhdm
#/usr/local/share/uhdm/UHDM.capnp
#/usr/local/lib/cmake/UHDM
#/usr/local/lib/pkgconfig/UHDM.pc
#/usr/local/bin/surelog
#/usr/local/bin/roundtrip
#/usr/local/lib/libsurelog.a
#/usr/local/lib/libantlr4-runtime.a
#/usr/local/lib/libcapnp.a
#/usr/local/lib/libkj.a
#/usr/local/lib/libuhdm.a
#/usr/local/share/surelog
#/usr/local/include/Surelog
#/usr/local/lib/cmake/Surelog
#/usr/local/lib/pkgconfig/Surelog.pc
